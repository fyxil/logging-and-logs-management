# Лабораторная работа: Управление логами и логгирование

## Цель лабораторной работы

Освоить навыки управления системными логами в операционных системах Linux: научиться просматривать, фильтровать и структурировать логи, а также настраивать автоматическую обработку лог-файлов.

## Теоретическая часть

### Логирование

Логирование — это процесс записи событий, происходящих в системе или приложении, для последующего анализа и диагностики. В Linux ключевые инструменты для работы с логами включают:

- **`journalctl`**: утилита для взаимодействия с системным журналом.
- **`logger`**: инструмент для добавления пользовательских записей в системный журнал.
- **`logrotate`**: программа для автоматической архивации и управления лог-файлами.

## Задания для выполнения

### Задание 1: Анализ системного журнала

1. Запустите системный журнал в терминале:
    ```bash
    journalctl
    ```
    Обратите внимание на структуру данных и типы записей.

2. Отфильтруйте логи за последние два часа:
    ```bash
    journalctl --since "2 hours ago"
    ```

3. Просмотрите логи для конкретного сервиса, например, `cron`:
    ```bash
    journalctl -u cron
    ```

4. Сохраните результат фильтрации в текстовый файл:
    ```bash
    journalctl -u cron --since "2 hours ago" > cron_logs.txt
    ```

### Задание 2: Внесение пользовательских данных в журнал

1. Добавьте тестовую запись в системный журнал с помощью команды `logger`:
    ```bash
    logger "Проверка записи в системный журнал: задача выполнена."
    ```

2. Проверьте, появилась ли ваша запись, используя:
    ```bash
    journalctl | grep "Проверка записи"
    ```

### Задание 3: Конфигурация управления логами

1. Создайте тестовый лог-файл для вашего приложения:
    ```bash
    sudo touch /var/log/customapp.log
    ```

2. Настройте автоматическое управление этим логом. Создайте новый конфигурационный файл для `logrotate`:
    ```bash
    sudo nano /etc/logrotate.d/customapp
    ```

3. Добавьте в файл следующие строки:
    ```bash
    /var/log/customapp.log {
        weekly
        rotate 4
        compress
        missingok
        notifempty
    }
    ```

4. Проверьте работоспособность настройки:
    ```bash
    sudo logrotate -f /etc/logrotate.d/customapp
    ```

5. Убедитесь, что лог-файлы были заархивированы корректно:
    ```bash
    ls /var/log/customapp.log*
    ```

## Практическая задача

### Задача

Настроить логгирование для пользовательского приложения с учётом следующих требований:

- Лог-файлы должны создаваться и ротация должна происходить раз в неделю.
- Система должна хранить не более трёх архивов.
- Старые логи должны автоматически сжиматься для экономии места.

### Шаги выполнения

1. Настройте лог-файл для приложения, используя подходящие команды.
2. Создайте конфигурационный файл для logrotate, соответствующий требованиям задачи.
3. Проверьте настройку на тестовом файле.

## Ресурсы для изучения

- **Журнал systemd**: документация journalctl
- **Утилита logger**: как добавить данные в системный журнал
- **logrotate**: основы настройки и примеры

## Итог

Выполнив лабораторную работу, вы приобрели навыки анализа системных журналов, добавления пользовательских записей и настройки автоматического управления логами. Эти навыки помогут вам эффективно администрировать серверы и диагностировать их работу.

